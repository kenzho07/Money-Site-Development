/**
* DO NOT EDIT THIS FILE.
* See the following change record for more information,
* https://www.drupal.org/node/2815083
* @preserve
**/

(function ($, Drupal) {
  Drupal.AjaxCommands.prototype.editorDialogSave = function (ajax, response, status) {
    $(window).trigger('editor:dialogsave', [response.values]);
  };
})(jQuery, Drupal);;
/**
 * @file
 * Some basic behaviors and utility functions for Linkit.
 */

(function ($, Drupal, drupalSettings) {

  'use strict';

  /**
   * @namespace
   */
  Drupal.linkit = {};

})(jQuery, Drupal, drupalSettings);
;
/**
 * @file
 * Linkit Autocomplete based on jQuery UI.
 */

(function ($, Drupal, _, document) {

  'use strict';

  var autocomplete;

  /**
   * JQuery UI autocomplete source callback.
   *
   * @param {object} request
   * @param {function} response
   */
  function sourceData(request, response) {
    var elementId = this.element.attr('id');

    if (!(elementId in autocomplete.cache)) {
      autocomplete.cache[elementId] = {};
    }

    /**
     * @param {object} suggestions
     */
    function showSuggestions(suggestions) {
      response(suggestions.matches);
    }

    /**
     * Transforms the data object into an array and update autocomplete results.
     *
     * @param {object} data
     */
    function sourceCallbackHandler(data) {
      autocomplete.cache[elementId][term] = data;
      showSuggestions(data);
    }

    // Get the desired term and construct the autocomplete URL for it.
    var term = request.term;

    // Check if the term is already cached.
    if (autocomplete.cache[elementId].hasOwnProperty(term)) {
      showSuggestions(autocomplete.cache[elementId][term]);
    }
    else {
      var options = $.extend({success: sourceCallbackHandler, data: {q: term}}, autocomplete.ajax);
      $.ajax(this.element.attr('data-autocomplete-path'), options);
    }
  }

  /**
    * Handles an autocomplete select event.
    *
    * @param {jQuery.Event} event
    * @param {object} ui
    *
    * @return {boolean}
    */
  function selectHandler(event, ui) {
    if (ui.item.hasOwnProperty('path')) {
      event.target.value = ui.item.path;
    }
    $(document).trigger('linkit.autocomplete.select', [event, ui]);
    return false;
  }

  /**
   * Override jQuery UI _renderItem function to output HTML by default.
   *
   * @param {object} ul
   *   The <ul> element that the newly created <li> element must be appended to.
   * @param {object} item
   *
   * @return {object}
   */
  function renderItem(ul, item) {
    var $line = $('<li>').addClass('linkit-result');
    $line.append($('<span>').html(item.title).addClass('linkit-result--title'));

    if (item.description !== null) {
      $line.append($('<span>').html(item.description).addClass('linkit-result--description'));
    }

    return $line.appendTo(ul);
  }

  /**
   * Override jQuery UI _renderMenu function to handle groups.
   *
   * @param {object} ul
   *   An empty <ul> element to use as the widget's menu.
   * @param {array} items
   *   An Array of items that match the user typed term.
   */
  function renderMenu(ul, items) {
    var self = this.element.autocomplete('instance');

    var grouped_items = _.groupBy(items, function (item) {
      return item.hasOwnProperty('group') ? item.group : '';
    });

    $.each(grouped_items, function (group, items) {
      if (group.length) {
        ul.append('<li class="linkit-result--group">' + group + '</li>');
      }

      $.each(items, function (index, item) {
        self._renderItemData(ul, item);
      });
    });
  }

  /**
   * Attaches the autocomplete behavior to all required fields.
   *
   * @type {Drupal~behavior}
   */
  Drupal.behaviors.linkit_autocomplete = {
    attach: function (context) {
      // Act on textfields with the "form-autocomplete" class.
      var $autocomplete = $(context).find('input.form-linkit-autocomplete').once('linkit-autocomplete');
      if ($autocomplete.length) {
        $.widget('custom.autocomplete', $.ui.autocomplete, {
          _create: function () {
            this._super();
            this.widget().menu('option', 'items', '> :not(.linkit-result--group)');
          },
          _renderMenu: autocomplete.options.renderMenu,
          _renderItem: autocomplete.options.renderItem
        });

        // Use jQuery UI Autocomplete on the textfield.
        $autocomplete.autocomplete(autocomplete.options);
        $autocomplete.autocomplete('widget').addClass('linkit-ui-autocomplete');
      }
    },
    detach: function (context, settings, trigger) {
      if (trigger === 'unload') {
        $(context).find('input.form-linkit-autocomplete')
          .removeOnce('linkit-autocomplete')
          .autocomplete('destroy');
      }
    }
  };

  /**
   * Autocomplete object implementation.
   */
  autocomplete = {
    cache: {},
    options: {
      source: sourceData,
      renderItem: renderItem,
      renderMenu: renderMenu,
      select: selectHandler,
      minLength: 1
    },
    ajax: {
      dataType: 'json'
    }
  };

})(jQuery, Drupal, _, document);
;
/**
 * @file
 * Title attribute functions.
 */

(function ($, Drupal, document) {

  'use strict';

  var fieldName = '[name="attributes[title]"]';

  /**
   * Automatically populate the title attribute.
   */
  $(document).bind('linkit.autocomplete.select', function (triggerEvent, event, ui) {
    if (ui.item.hasOwnProperty('title')) {
      $('form.linkit-editor-dialog-form').find(fieldName).val(ui.item.title);
    }
  });

})(jQuery, Drupal, document);
;
/**
 * @file
 * IMCE integration for Linkit.
 */

(function ($, Drupal, drupalSettings) {

  'use strict';

  /**
   * @namespace
   *
   * Need to be in the global namespace, otherwise the IMCE window will not show
   * the 'select' button in the toolbar.
   */
  var linkitImce = window.linkitImce = {};

  /**
   * Drupal behavior to handle imce linkit integration.
   */
  Drupal.behaviors.linkitImce = {
    attach: function (context, settings) {
      var $link = $(context).find('.linkit-imce-open').once('linkit-imce-open');
      if ($link.length) {
        $link.bind('click', function (event) {
          event.preventDefault();
          window.open($(this).attr('href'), '', 'width=760,height=560,resizable=1');
        });
      }
    }
  };

  /**
   * Handler for imce sendto operation.
   */
  linkitImce.sendto = function (file, win) {
    var imce = win.imce;
    var items = imce.getSelection();

    if (imce.countSelection() > 1) {
      imce.setMessage(Drupal.t('You can only select one file.'));
      return;
    }
    var path = imce.getConf('root_url') + '/' + imce.getItemPath(items[0]);
    $('[data-drupal-selector="edit-attributes-href"]').val(path);
    win.close();
  };


})(jQuery, Drupal, drupalSettings);


;
